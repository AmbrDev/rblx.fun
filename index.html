<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>RBLX.Fun</title>

    <link rel="shortcut icon" type="image/x-icon" href="https://raw.githubusercontent.com/Cryption/rblx.fun/master/favicon.ico">

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.0/css/materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.0/js/materialize.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <style>
        .modal {
            max-height: 90%;
        }

        .modal-form-row {
            margin-bottom: 0px;
        }

        .align-price {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
        }

        .item {
            width: 300px;
            display: inline-block;
            margin: 10px 10px 10px 10px;
        }

        .crate-item {
            width: 134px;
            display: inline-block;
            border-radius: 3px;
            margin: 5px 5px 5px 5px;
        }

        .crate-preview {
            position: absolute;
            bottom: -50px;
            right: -30px;
            width: 75%;
        }

        .spin-open {
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.14);
            width: 100%;
            white-space: nowrap;
            position: relative;
            overflow-x: hidden;
            overflow-y: hidden;
        }

        .spin-overlay {
            position: absolute;
            top: 0px;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0px 0px 20px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .spin-items {
            width: 100%;
            height: 100%;
        }

        .divider {
            content: "";
            position: absolute;
            height: 100%;
            left: 50%;
            margin-left: -3px;
            background: rgba(0,255,144,.6);
            width: 6px;
            z-index: 10;
            box-shadow: -1px 1px 8px 1px rgba(50,50,50,.75);
        }

        .item-name {
            text-overflow: ellipsis;
            white-space: nowrap;
            width: 100%;
            overflow: hidden;
        }

        .case-items {
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.14);
            width: 100%;
            position: relative;
        }

        .user-items {
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.14);
            width: 100%;
            position: relative;
            min-height: 193px;
        }

        .user-item {
            height: 200px;
            display: inline-block;
            border-radius: 3px;
            margin: 5px 5px 5px 5px;
        }

        .winning-numbers {
            content: " ";
        }

        .item-overlay {
            width: unset !important;
            position: absolute !important;
            bottom: 0px !important;
            left: 0px !important;
            top: unset !important;
            right: unset !important;
        }
    </style>

    <script>
        var tagBody = '(?:[^"\'>]|"[^"]*"|\'[^\']*\')*';

        var tagOrComment = new RegExp(
            '<(?:'
            // Comment body.
            + '!--(?:(?:-*[^->])*--+|-?)'
            // Special "raw text" elements whose content should be elided.
            + '|script\\b' + tagBody + '>[\\s\\S]*?</script\\s*'
            + '|style\\b' + tagBody + '>[\\s\\S]*?</style\\s*'
            // Regular name
            + '|/?[a-z]'
            + tagBody
            + ')>',
            'gi');
        function removeTags(html) {
            var oldHtml;
            do {
                oldHtml = html;
                html = html.replace(tagOrComment, '');
            } while (html !== oldHtml);
            return html.replace(/</g, '&lt;').replace(/"/g, '').replace(/'/g, '').replace(/\\/g, '');
        }
        function htmlToElement(html) {
            var template = document.createElement('template');
            template.innerHTML = html;
            return template.content.firstChild;
        }
    </script>

    <script>
        var cardTemplate = "PGRpdiBjbGFzcz0iY2FyZCBpdGVtIj4KCTxkaXYgY2xhc3M9ImNhcmQtaW1hZ2UiPgoJCTxpbWcgc3JjPSJ7MH0iPgoJCTxzcGFuIGNsYXNzPSJjcmF0ZS1wcmV2aWV3Ij48aW1nIHNyYz0iezN9Ij48L3NwYW4+Cgk8L2Rpdj4KCTxkaXYgY2xhc3M9ImNhcmQtY29udGVudCI+CgkJPHNwYW4gY2xhc3M9ImNhcmQtdGl0bGUiPnsxfTwvc3Bhbj4KCQk8ZGl2IGNsYXNzPSJjb2wgczYiPgoJCQk8c3BhbiBjbGFzcz0iZ3JleS10ZXh0Ij4KCQkJCVByaWNlCgkJCTwvc3Bhbj4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJjb2wgczYiPgoJCQk8c3BhbiBjbGFzcz0iZ3JlZW4tdGV4dCBhbGlnbi1wcmljZSI+CgkJCQk8aW1nIHN0eWxlPSJtYXgtaGVpZ2h0OiAyMHB4OyIgc3JjPSIvL3JieC5wbGFjZS9pbWcvZnVuZHMucG5nIiAvPgoJCQkJezJ9CgkJCTwvc3Bhbj4KCQk8L2Rpdj4KCTwvZGl2PgoJPGRpdiBjbGFzcz0iY2FyZC1hY3Rpb24iPgoJCTxzcGFuIGNsYXNzPSJidG4gd2F2ZXMtZWZmZWN0IHdhdmVzLWxpZ2h0IGdyZWVuIiBvbmNsaWNrPSJkaXNwbGF5Q3JhdGVPcGVuZXIodGhpcyk7Ij5PUEVOIENSQVRFPC9zcGFuPgoJPC9kaXY+CjwvZGl2Pg==";
        var itemTemplate = "PGRpdiBjbGFzcz0iY2FyZCBjcmF0ZS1pdGVtIj4KCTxkaXYgY2xhc3M9ImNhcmQtaW1hZ2UiIHN0eWxlPSJib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjEpIj4KCQk8aW1nIHNyYz0iezB9Ij4KCQl7NH0KCTwvZGl2PgoJPGRpdiBjbGFzcz0iY2FyZC1jb250ZW50IiBzdHlsZT0icGFkZGluZzogNHB4IDRweCA0cHggNHB4Ij4KCQk8cCBjbGFzcz0iaXRlbS1uYW1lIj57MX08L3A+CgkJPHAgY2xhc3M9ImdyZXktdGV4dCI+ezN9PC9wPgoJCTxkaXYgY2xhc3M9ImNvbCBzMTIiPgoJCQk8c3BhbiBjbGFzcz0iZ3JlZW4tdGV4dCBhbGlnbi1wcmljZSI+CgkJCQk8aW1nIHN0eWxlPSJtYXgtaGVpZ2h0OiAyMHB4OyIgc3JjPSIvL3JieC5wbGFjZS9pbWcvZnVuZHMucG5nIiAvPgoJCQkJezJ9CgkJCTwvc3Bhbj4KCQk8L2Rpdj4KCTwvZGl2Pgo8L2Rpdj4=";
        var inveTemplate = "PGRpdiBjbGFzcz0iY2FyZCBob3Jpem9udGFsIHVzZXItaXRlbSI+Cgk8ZGl2IGNsYXNzPSJjYXJkLWltYWdlIj4KCQk8aW1nIHNyYz0iezB9IiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgc3R5bGU9IndpZHRoOiAyMDBweCI+CgkJezR9Cgk8L2Rpdj4KCTxkaXYgY2xhc3M9ImNhcmQtc3RhY2tlZCI+CgkJPGRpdiBjbGFzcz0iY2FyZC1jb250ZW50IiBzdHlsZT0icGFkZGluZzogNHB4IDRweCA0cHggNHB4Ij4KCQkJPGg0PnsxfTwvaDQ+CgkJCTxwPjxzcGFuIGNsYXNzPSJncmV5LXRleHQiPlByaWNlOiA8L3NwYW4+CgkJCQk8c3BhbiBjbGFzcz0iZ3JlZW4tdGV4dCBhbGlnbi1wcmljZSI+CgkJCQkJPGltZyBzdHlsZT0ibWF4LWhlaWdodDogMjBweDsiIHNyYz0iLy9yYngucGxhY2UvaW1nL2Z1bmRzLnBuZyIgLz4KCQkJCQl7Mn0KCQkJCTwvc3Bhbj4KCQkJPC9wPgoJCTwvZGl2PgoJCTxkaXYgY2xhc3M9ImNhcmQtYWN0aW9uIj4KCQkJPHNwYW4gY2xhc3M9ImJ0biB3YXZlcy1lZmZlY3Qgd2F2ZXMtbGlnaHQgb3JhbmdlIiBvbmNsaWNrPSIiIGRpc2FibGVkPSJkaXNhYmxlZCI+V0lUSERSQVc8L3NwYW4+CgkJCTxzcGFuIGNsYXNzPSJidG4gd2F2ZXMtZWZmZWN0IHdhdmVzLWxpZ2h0IGdyZWVuIiBvbmNsaWNrPSJjb252ZXJ0VG9Sb2J1eCh0aGlzKTsiPkNPTlZFUlQgVE8gUiQ8L3NwYW4+CgkJPC9kaXY+Cgk8L2Rpdj4KPC9kaXY+";
        var creaTemplate = "PGRpdiBjbGFzcz0iY2FyZCBob3Jpem9udGFsIHVzZXItaXRlbSIgc3R5bGU9ImhlaWdodDogMjUwcHgiPgoJPGRpdiBjbGFzcz0iY2FyZC1pbWFnZSI+CgkJPGltZyBzcmM9InswfSIgd2lkdGg9IjI1MCIgaGVpZ2h0PSIyNTAiIHN0eWxlPSJ3aWR0aDogMjUwcHgiPgoJCXs0fQoJPC9kaXY+Cgk8ZGl2IGNsYXNzPSJjYXJkLXN0YWNrZWQiPgoJCTxkaXYgY2xhc3M9ImNhcmQtY29udGVudCIgc3R5bGU9InBhZGRpbmc6IDRweCA0cHggNHB4IDRweCI+CgkJCTxoND57MX08L2g0PgoJCQk8cD48c3BhbiBjbGFzcz0iZ3JleS10ZXh0Ij5QcmljZTogPC9zcGFuPgoJCQkJPHNwYW4gY2xhc3M9ImdyZWVuLXRleHQgYWxpZ24tcHJpY2UiPgoJCQkJCTxpbWcgc3R5bGU9Im1heC1oZWlnaHQ6IDIwcHg7IiBzcmM9Ii8vcmJ4LnBsYWNlL2ltZy9mdW5kcy5wbmciIC8+CgkJCQkJezJ9CgkJCQk8L3NwYW4+CgkJCTwvcD4KCQkJPGRpdiBjbGFzcz0icm93IG1vZGFsLWZvcm0tcm93Ij4KCQkJCTxkaXYgY2xhc3M9ImlucHV0LWZpZWxkIGNvbCBzMTIiPgoJCQkJCTxpbnB1dCBpZD0ib2RkcyIgdHlwZT0ibnVtYmVyIiBtaW49IjAiIG1heD0iMTAwIiBzdGVwPSIwLjAwMSIgb25jaGFuZ2U9InNldEl0ZW1PZGRzKHRoaXMpOyIgb25rZXl1cD0ic2V0SXRlbU9kZHModGhpcyk7IiB2YWx1ZT0wIGNsYXNzPSJ2YWxpZGF0ZSB2YWxpZCI+CgkJCQkJPGxhYmVsIGZvcj0ib2RkcyIgY2xhc3M9ImFjdGl2ZSI+T2RkczwvbGFiZWw+CgkJCQk8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0iY2FyZC1hY3Rpb24iPgoJCQk8c3BhbiBjbGFzcz0iYnRuIHdhdmVzLWVmZmVjdCB3YXZlcy1saWdodCByZWQiIG9uY2xpY2s9InJlbW92ZUNyYXRlSXRlbSh0aGlzKTsiPlJFTU9WRTwvc3Bhbj4KCQkJPHNwYW4gY2xhc3M9ImJ0biB3YXZlcy1lZmZlY3Qgd2F2ZXMtbGlnaHQgZ3JlZW4iIG9uY2xpY2s9InNldFByaW1hcnlJdGVtKHRoaXMpOyI+TUFLRSBQUklNQVJZPC9zcGFuPgoJCTwvZGl2PgoJPC9kaXY+CjwvZGl2Pg==";

        var itemEndPoint = 'https://api.roblox.com/Marketplace/ProductInfo?assetId={0}';
        var thumbnailEndPoint = 'https://www.roblox.com/Thumbs/Asset.ashx?width=420&height=420&assetId={0}';
        var catalogEndPoint = 'https://search.roblox.com/catalog/json?CreatorID={0}&Keyword={1}&ResultsPerPage=1';
        var searchEndPoint = 'https://search.roblox.com/catalog/json?Category=0&Keyword={0}&ResultsPerPage=12&IncludeNotForSale=false&SortType=MostFavorited';
        var giftsEndPoint = 'https://search.roblox.com/catalog/items?Category=11&Direction={1}&IncludeNotForSale=true&Keyword=opened+gift&Subcategory=9&ResultsPerPage=12&PageNumber={0}&PageHash={2}';
        var pageHash = '';

        var invalidItem = {
            img: 'https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading.png',
            name: 'Unknown Item',
            price: 0,
            overlay: 0
        };

        var itemCache = [];
        var userInventory = ['376524487', '376524487', '376524487'];

        var overlays = ['', '<img src="https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/limited.png" class="item-overlay">', '<img src="https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/limitedunique.png" class="item-overlay">'];

        if (!String.prototype.format) {
            String.prototype.format = function () {
                var args = arguments;
                return this.replace(/{(\d+)}/g, function (match, number) {
                    return typeof args[number] != 'undefined'
                        ? args[number]
                        : match
                        ;
                });
            };
        }

        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        function getValue(price) {
            return price <= 0 ? "Free" : price.toLocaleString();
        }

        function displayCard(items, img, title, price, preview) {
            var crates = document.getElementById('crates');
            var card = htmlToElement(atob(cardTemplate).format(removeTags(img), removeTags(title), getValue(price), removeTags(preview)));

            card.crateTitle = title;
            card.cratePrice = price;
            card.crateItems = items;

            crates.appendChild(card);
        }

        function getItem(id, callback) {
            for (var i = 0; i < itemCache.length; i++) {
                if (itemCache[i].id == id) {
                    if (itemCache[i].downloaded) {
                        callback(itemCache[i].item);
                        return;
                    } else {
                        itemCache[i].callbacks.push(callback);
                        return;
                    }
                }
            }

            var itemCacheObj = {
                id: id,
                downloaded: false,
                item: invalidItem,
                callbacks: [callback]
            };

            itemCache.push(itemCacheObj);

            $.ajax({
                url: 'https://crossorigin.me/' + itemEndPoint.format(id),
                success: function (data) {
                    var responseJson = data;
                    var price = 0;

                    console.log(responseJson);

                    if (!responseJson.IsPublicDomain) {
                        if (responseJson.IsForSale || responseJson.IsLimited || responseJson.IsLimitedUnique) {
                            if (responseJson.IsLimited || responseJson.IsLimitedUnique) {
                                $.ajax({
                                    url: 'https://crossorigin.me/' + catalogEndPoint.format(responseJson.Creator.Id, responseJson.Name),
                                    success: function (data) {
                                        var listingJson = data[0];

                                        if (listingJson.AssetId == responseJson.AssetId) {
                                            itemCacheObj.item = {
                                                img: thumbnailEndPoint.format(id),
                                                name: responseJson.Name,
                                                price: parseInt(listingJson.BestPrice.replace(/,/g, '')),
                                                overlay: responseJson.IsLimitedUnique ? 2 : (responseJson.IsLimited ? 1 : 0)
                                            };
                                            itemCacheObj.downloaded = true;
                                            for (var i = 0; i < itemCacheObj.callbacks.length; i++) {
                                                itemCacheObj.callbacks[i](itemCacheObj.item);
                                            }
                                        } else {
                                            itemCacheObj.downloaded = true;
                                            for (var i = 0; i < itemCacheObj.callbacks.length; i++) {
                                                itemCacheObj.callbacks[i](invalidItem);
                                            }
                                        }
                                    }
                                });
                                
                                return;
                            } else {
                                price = responseJson.PriceInRobux;
                            }
                        } else {
                            itemCacheObj.downloaded = true;
                            for (var i = 0; i < itemCacheObj.callbacks.length; i++) {
                                itemCacheObj.callbacks[i](invalidItem);
                            }
                            return;
                        }
                    }

                    itemCacheObj.downloaded = true;
                    itemCacheObj.item = {
                        img: thumbnailEndPoint.format(id),
                        name: responseJson.Name,
                        price: price,
                        overlay: responseJson.IsLimitedUnique ? 2 : (responseJson.IsLimited ? 1 : 0)
                    };
                    for (var i = 0; i < itemCacheObj.callbacks.length; i++) {
                        itemCacheObj.callbacks[i](itemCacheObj.item);
                    }
                }
            });
        }

        function testSpin() {
            var targetItem = "";
            var spinFrame = document.getElementById('spinFrame');
            var crate = spinFrame.children;

            var winningNumber = parseInt(Math.random() * spinFrame.winningNumbers);

            var winningNumbers = 0;
            var items = spinFrame.items;
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var numbersRange = winningNumbers + item.tickets;

                if (winningNumber >= winningNumbers && winningNumber < numbersRange) {
                    targetItem = item.id;
                }

                winningNumbers = numbersRange;
            }

            var audio = new Audio('https://raw.githubusercontent.com/Cryption/rblx.fun/master/tick.wav');
            var prize = new Audio('https://github.com/Cryption/rblx.fun/blob/master/prize.mp3?raw=true');

            var targetIndex = parseInt(Math.random() * (crate.length - 20)) + 10;
            for (var i = targetIndex; i < crate.length; i++) {
                if (crate[i].item.id == targetItem) {
                    targetIndex = i;
                    break;
                }
            }

            console.log("New Test Spin!\nWinning Number: " + winningNumber + "\nPrize: " + targetItem);

            var targetX = (spinFrame.clientWidth / 2) - (crate[targetIndex].offsetLeft + (Math.random() * crate[targetIndex].clientWidth));
            var x = 0;
            var maxSpeed = 50;
            if (typeof (currentSpin) != 'undefined')
                clearInterval(currentSpin);

            currentSpin = setInterval(function () {
                if (parseInt((x + (crate[targetIndex].clientWidth / 2)) / crate[targetIndex].clientWidth) < parseInt((x + Math.min(maxSpeed, (-targetX - x) * .006) + (crate[targetIndex].clientWidth / 2)) / crate[targetIndex].clientWidth)) {
                    audio.play();
                }

                if ((-targetX - x) <= 2) {
                    x = -targetX;
                    prize.play();

                    clearInterval(currentSpin);
                }

                x += Math.min(maxSpeed, (-targetX - x) * .006);

                spinFrame.style.webkitTransform = "translateX(" + -x + "px)";
                spinFrame.style.transform = "translateX(" + -x + "px)";
                spinFrame.style.msTransform = "translateX(" + -x + "px)";
            }, 15);
        }

        function displayCrateOpener(btn) {
            var items = btn.parentElement.parentElement.crateItems;

            if (typeof (currentSpin) != 'undefined')
                clearInterval(currentSpin);

            document.getElementById('crateTitle').innerHTML = removeTags(btn.parentElement.parentElement.crateTitle);
            document.getElementById('cratePrice').innerHTML = getValue(btn.parentElement.parentElement.cratePrice);
            document.getElementById('winningNumbersCheckbox').checked = false;
            document.getElementById('spinFrame').innerHTML = "";
            document.getElementById('caseInventory').innerHTML = "";
            for (var j = 0; j < 25; j++) {
                var shuffledItems = shuffle(items.slice(0));
                for (var i = 0; i < items.length; i++) {
                    var item = shuffledItems[i];
                    var itemCard = htmlToElement(atob(itemTemplate).format('https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading.png', 'Loading', 'Loading...', '', ''));
                    (function (itemCard) {
                        getItem(item.id, function (listing) {
                            itemCard.innerHTML = htmlToElement(atob(itemTemplate).format(removeTags(listing.img), removeTags(listing.name), getValue(listing.price), '', overlays[listing.overlay])).innerHTML;
                        });
                    })(itemCard);
                    itemCard.item = item;
                    document.getElementById('spinFrame').appendChild(itemCard);
                }
            }

            var winningNumbers = 0;
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var itemCard = htmlToElement(atob(itemTemplate).format('https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading.png', 'Loading', 'Loading...', '', ''));
                (function (itemCard, winningNumbers, item) {
                    getItem(item.id, function (listing) {
                        itemCard.innerHTML = htmlToElement(atob(itemTemplate).format(removeTags(listing.img), removeTags(listing.name), getValue(listing.price), '<span class="winning-numbers" ' + (document.getElementById('winningNumbersCheckbox').checked ? '' : 'style="display: none"') + '>' + winningNumbers + ' - ' + (winningNumbers + item.tickets) + '</span>', overlays[listing.overlay])).innerHTML;
                    });
                })(itemCard, winningNumbers, item);
                winningNumbers += item.tickets;
                document.getElementById('caseInventory').appendChild(itemCard);
            }
            document.getElementById('spinFrame').winningNumbers = winningNumbers;
            document.getElementById('spinFrame').items = items;

            $(".winning-numbers").hide();
            $('#open-crate').modal('open');
        }

        function addInventoryItem(id) {
            var itemCard = htmlToElement(atob(inveTemplate).format('https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading.png', 'Loading', 'Loading...', '', ''));
            (function (itemCard) {
                getItem(id, function (listing) {
                    itemCard.innerHTML = htmlToElement(atob(inveTemplate).format(removeTags(listing.img), removeTags(listing.name), getValue(listing.price), '', overlays[listing.overlay])).innerHTML;
                });
            })(itemCard);
            document.getElementById('inventoryDiv').appendChild(itemCard);
        }

        function convertToRobux(btn) {
            var item = btn.parentElement.parentElement.parentElement;
            $(item).hide(250);
        }

        function convertAllToRobux() {
            userInventory = [];
            var inv = document.getElementById('inventoryDiv').children;
            for (var i = 0; i < inv.length; i++)
                $(inv[i]).hide(250);
        }

        function openInventory() {
            $('#inventory').modal('open');
        }

        function createCrate() {
            var sum = 0;
            var price = 0;

            var smallestOdd = 100;

            $("[id='odds']").each(function (i, n) {
                sum += parseFloat($(n).val(), 10);
                smallestOdd = Math.min(smallestOdd, parseFloat($(n).val(), 10));
                var val = n.parentElement.parentElement.parentElement.children[1].children[1].innerText.replace(/,/g, '');
                price += Math.ceil((val == "Free" ? 0 : parseFloat(val)) * (parseFloat($(n).val(), 10) / 100.0));
            });

            document.getElementById('oddsSum').innerHTML = sum;
            document.getElementById('calculatedPrice').innerHTML = getValue(price);
            document.getElementById('cratePreviewPrice').innerHTML = getValue(price);

            var crate = {
                img: document.getElementById('cratePreviewIcon').src,
                title: document.getElementById('caseName').value,
                price: price,
                preview: document.getElementById('cratePreviewPreview').src,
                items: []
            };

            var crateItems = document.getElementById('creatorDiv').children;
            for (var i = 0; i < crateItems.length; i++) {
                crate.items.push({
                    id: crateItems[i].id,
                    tickets: parseInt(parseFloat($(crateItems[i]).find('#odds').val()) / 0.001)
                    });
            }

            if (document.getElementById('caseName').value == "") {
                toastr.error("You must enter a crate name!");
            } else if (sum != 100) {
                toastr.error("The total odds must be 100%!");
            } else if (smallestOdd < 0.001) {
                toastr.error("The odds for any item cannot be less than 0.001!");
            } else {
                console.log("New Crate!\nJSON: " + JSON.stringify(crate) + "\n\nBase64: " + btoa(JSON.stringify(crate)));
                toastr.succes("Crate logged to console");
            }
        }

        function setItemOdds(btn) {
            var sum = 0;
            var price = 0;

            $("[id='odds']").each(function (i, n) {
                sum += parseFloat($(n).val(), 10);
                var val = n.parentElement.parentElement.parentElement.children[1].children[1].innerText.replace(/,/g, '');
                price += Math.ceil((val == "Free" ? 0 : parseFloat(val)) * (parseFloat($(n).val(), 10) / 100.0));
            });

            document.getElementById('oddsSum').innerHTML = sum;
            document.getElementById('calculatedPrice').innerHTML = getValue(price);
            document.getElementById('cratePreviewPrice').innerHTML = getValue(price);
        }

        function setPrimaryItem(btn) {
            document.getElementById('cratePreviewPreview').src = btn.parentElement.parentElement.parentElement.children[0].children[0].src;
        }

        function removeCrateItem(btn) {
            var card = btn.parentElement.parentElement.parentElement;
            card.parentElement.removeChild(card);

            setItemOdds(btn);
        }

        function setGiftsPage(page, direction) {
            if (page < 0) {
                page = 0;
                return;
            }

            document.getElementById('pageNumber').innerHTML = (page + 1);
            document.getElementById('gifts').innerHTML = "";
            
            document.getElementById('nextPage').setAttribute('disabled', 'disabled');
            document.getElementById('prevPage').setAttribute('disabled', 'disabled');

            setTimeout(function () {
                $.ajax({
                    url: 'https://crossorigin.me/' + giftsEndPoint.format(page, direction, pageHash),
                    success: function (data) {
                        pageHash = data.PageHash;

                        document.getElementById('nextPage').removeAttribute('disabled');
                        document.getElementById('prevPage').removeAttribute('disabled');
                        
                        if (parseInt(document.getElementById('pageNumber').innerHTML) == (page + 1)) {
                            for (var i = 0; i < data.Items.length; i++) {
                                var itemCard = htmlToElement(atob(itemTemplate).format(thumbnailEndPoint.format(data.Items[i].AssetId), '', '', '', ''));
                                var addButton = document.createElement('button');
                                addButton.setAttribute('class', 'btn waves-effect waves-light');
                                addButton.setAttribute('style', 'width: 100%');
                                addButton.innerHTML = "Set Icon";
                                (function (id) {
                                    addButton.onclick = function () {
                                        document.getElementById('cratePreviewIcon').src = thumbnailEndPoint.format(id);
                                    };
                                })(data.Items[i].AssetId);
                                itemCard.children[1].appendChild(addButton);

                                var content = itemCard.children[1];
                                content.removeChild(content.children[2]);

                                document.getElementById('gifts').appendChild(itemCard);
                            }
                        }
                    }
                });
            }, 1000);
        }
        
        $(document).ready(function () {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }

            // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
            $('.modal').modal();
            $('ul.tabs').tabs();

            var crates = [
                'eyJpbWciOiJodHRwczovL3d3dy5yb2Jsb3guY29tL1RodW1icy9Bc3NldC5hc2h4P3dpZHRoPTQyMCZoZWlnaHQ9NDIwJmFzc2V0SWQ9NDE0NTI2OTgiLCJ0aXRsZSI6InRoZSBmaXJzdCBjcmF0ZSIsInByaWNlIjoxMDE4LCJwcmV2aWV3IjoiaHR0cHM6Ly93d3cucm9ibG94LmNvbS9UaHVtYnMvQXNzZXQuYXNoeD93aWR0aD00MjAmaGVpZ2h0PTQyMCZhc3NldElkPTQ1MTIyMTMyOSIsIml0ZW1zIjpbeyJpZCI6IjM3NjUyNDQ4NyIsInRpY2tldHMiOjIwMDAwfSx7ImlkIjoiMzc2NTI2ODg4IiwidGlja2V0cyI6MjAwMDB9LHsiaWQiOiI0NTEyMjEzMjkiLCJ0aWNrZXRzIjo0MDAwMH0seyJpZCI6IjYzNjkwMDA4IiwidGlja2V0cyI6MTk5ODl9LHsiaWQiOiI0ODU0NTgwNiIsInRpY2tldHMiOjEwfV19'
            ];

            for (var i = 0; i < crates.length; i++) {
                var c = JSON.parse(atob(crates[i]));
                displayCard(c.items, c.img, c.title, c.price, c.preview);
            }

            for (var i = 0; i < userInventory.length; i++) {
                addInventoryItem(userInventory[i]);
            }

            $('#winningNumbersCheckbox').on('change', function () {
                var c = this.checked;
                if (c)
                    $(".winning-numbers").show(100);
                else
                    $(".winning-numbers").hide(100);
            });

            $("#caseName").on("keyup", function (e) {
                $("#cratePreviewName").html($(this).val());
            });

            $("#catalogSearch").on("keyup", function (e) {
                var query = $(this).val();
                if (typeof (searchTimeout) != 'undefined')
                    clearTimeout(searchTimeout);

                searchTimeout = setTimeout(function () {
                    $.ajax({
                        url: 'https://crossorigin.me/' + searchEndPoint.format(encodeURIComponent(query)),
                        success: function (data) {
                            if (query == $("#catalogSearch").val()) {
                                document.getElementById('catalogDiv').innerHTML = "";
                                for (var i = 0; i < data.length; i++) {
                                    var itemCard = htmlToElement(atob(itemTemplate).format('https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading.png', 'Loading', 'Loading...', '', ''));
                                    var addButton = document.createElement('button');
                                    addButton.setAttribute('class', 'btn waves-effect waves-light');
                                    addButton.setAttribute('style', 'width: 100%');
                                    addButton.innerHTML = "Add";
                                    (function (id) {
                                        addButton.onclick = function () {
                                            var itemCard = htmlToElement(atob(creaTemplate).format('https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading.png', 'Loading', 'Loading...', '', ''));
                                            (function (itemCard) {
                                                getItem(id, function (listing) {
                                                    itemCard.innerHTML = htmlToElement(atob(creaTemplate).format(removeTags(listing.img), removeTags(listing.name), getValue(listing.price), '', overlays[listing.overlay])).innerHTML;
                                                });
                                            })(itemCard);
                                            itemCard.id = id;
                                            document.getElementById('creatorDiv').appendChild(itemCard);
                                        };
                                    })(data[i].AssetId);
                                    itemCard.children[1].appendChild(addButton);

                                    (function (itemCard, id, addButton) {
                                        getItem(id, function (listing) {
                                            if (itemCard != null) {
                                                itemCard.innerHTML = htmlToElement(atob(itemTemplate).format(removeTags(listing.img), removeTags(listing.name), getValue(listing.price), '', overlays[listing.overlay])).innerHTML;
                                                itemCard.children[1].appendChild(addButton);
                                            }
                                        });
                                    })(itemCard, data[i].AssetId, addButton);

                                    document.getElementById('catalogDiv').appendChild(itemCard);
                                }
                            }
                        }
                    });
                }, 1000);
            });

            setGiftsPage(0, 1);
            $("#catalogSearch").keyup();
        });
        
        $("#signup_pass").on("focusout", function (e) {
            if ($(this).val() != $("#signup_confirmpass").val()) {
                $("#signup_confirmpass").removeClass("valid").addClass("invalid");
            } else {
                $("#signup_confirmpass").removeClass("invalid").addClass("valid");
            }
        });

        $("#signup_confirmpass").on("keyup", function (e) {
            if ($("#signup_pass").val() != $(this).val()) {
                $(this).removeClass("valid").addClass("invalid");
            } else {
                $(this).removeClass("invalid").addClass("valid");
            }
        });
    </script>
</head>
<body>
    <nav class="light-blue lighten-1" role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="#" class="brand-logo"><img src="https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/logo.png" style="padding-top: 4px; height: 60px;" /></a>
            <ul class="right hide-on-med-and-down">
                <li><a href="#crate-creator" class="modal-trigger">Crate Creator</a></li>
                <li><a href="#deposit" class="modal-trigger">Deposit</a></li>
                <li><a href="javascript:openInventory();">Inventory</a></li>
                <a href="#signin" class="btn waves-effect waves-light orange modal-trigger">Sign In</a>
            </ul>

            <ul id="nav-mobile" class="side-nav" style="transform: translateX(-100%);">
                <li><a href="#crate-creator" class="modal-trigger">Crate Creator</a></li>
                <li><a href="#deposit" class="modal-trigger">Deposit</a></li>
                <li><a href="javascript:openInventory();">Inventory</a></li>
                <a href="#signin" class="btn waves-effect waves-light orange modal-trigger">Sign In</a>
            </ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
        </div>
    </nav>

    <div id="signin" class="modal" style="width:20%">
        <div class="modal-header">
            <div class="row">
                <div class="col s12">
                    <ul class="tabs">
                        <li class="tab col s6"><a class="active" href="#sign-in">Sign In</a></li>
                        <li class="tab col s6"><a href="#sign-up">Sign Up</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="sign-in">
            <div class="modal-content">
                <h4>Sign In</h4>

                <div class="row">
                    <form class="col s12">
                        <div class="row modal-form-row">
                            <div class="input-field col s12">
                                <input id="signin_user" type="text" class="validate">
                                <label for="signin_user">Username</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="signin_pass" type="password" class="validate">
                                <label for="signin_pass">Password</label>
                            </div>
                        </div>
                        <div class="row">
                            <p>
                                <input type="checkbox" class="filled-in" id="rememberMe" />
                                <label for="rememberMe">Remember me</label>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <a class="modal-action modal-close btn waves-effect waves-light orange">Sign In</a>
            </div>
        </div>
        <div id="sign-up">
            <div class="modal-content">
                <h4>Sign Up</h4>

                <div class="row">
                    <form class="col s12">
                        <div class="row modal-form-row">
                            <div class="input-field col s12">
                                <input id="signup_user" type="text" class="validate">
                                <label for="signup_user">Username</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="signup_pass" type="password" class="validate">
                                <label for="signup_pass">Password</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="signup_confirmpass" type="password">
                                <label for="signup_confirmpass" data-error="Password not match" data-success="Password Match">Password (Confirm)</label>
                            </div>
                        </div>
                        <div class="row">
                            <p>
                                <input type="checkbox" class="filled-in" id="over18" />
                                <label for="over18">I am over 18</label>
                            </p>
                        </div>
                        <div class="row">
                            <p>
                                <input type="checkbox" class="filled-in" id="tos" />
                                <label for="tos">I agree to the <a href="http://kazok.men/">terms and conditions</a></label>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <a class="modal-action modal-close btn waves-effect waves-light orange">Sign Up</a>
            </div>
        </div>
    </div>

    <div id="deposit" class="modal">
        <div class="modal-content">
            <div class="row">
                <h4>Add Funds</h4>
            </div>
            <div class="row">
                <form class="col s12">
                    <div class="row modal-form-row">
                        <div class="input-field col s12">
                            <i class="prefix"><img style="max-height: 20px;" src="//rbx.place/img/funds.png" /></i>
                            <input id="funds" type="number" min="400" max="24000" class="validate">
                            <label for="funds">Amount of Funds</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="row">
                <a class="modal-action modal-close btn waves-effect waves-light orange" disabled="disabled">Deposit Items</a>
                <a class="modal-action modal-close btn waves-effect waves-light orange" disabled="disabled">Pay With <img style="max-height: 20px; transform:translateY(5px);" src="//rbx.place/img/funds.png" /></a>
                <a class="modal-action modal-close btn waves-effect waves-light green">Pay With Cash</a>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
        </div>
    </div>

    <div id="crate-creator" class="modal">
        <div class="modal-content">
            <div class="row">
                <h4>Create Your Own Crate</h4>
            </div>
            <div class="row">
                <div class="col s4">
                    <span id="prevPage" class="waves-effect waves-green btn left" onclick="setGiftsPage(parseInt(document.getElementById('pageNumber').innerHTML) - 2, 1)">Prev Page</span>
                </div>
                <div class="col s4 center">
                    Page <span id="pageNumber">1</span>
                </div>
                <div class="col s4">
                    <span id="nextPage" class="waves-effect waves-green btn right" onclick="setGiftsPage(parseInt(document.getElementById('pageNumber').innerHTML), 2)">Next Page</span>
                </div>
                <div class="col s12">
                    <div class="case-items" id="gifts" style="min-height: 380px">

                    </div>
                </div>
            </div>
            <div class="row">
                <form class="col s12">
                    <div class="row modal-form-row">
                        <div class="input-field col s12">
                            <input id="caseName" type="text" class="validate">
                            <label for="caseName">Case Name</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="row">
                <p>Catalog</p>
                <div class="row modal-form-row">
                    <div class="input-field col s12">
                        <input id="catalogSearch" type="text">
                        <label for="catalogSearch">Search</label>
                    </div>
                </div>
                <div class="case-items" id="catalogDiv">

                </div>
            </div>
            <div class="row">
                <p>Crate Items</p>
                <div class="user-items" id="creatorDiv">

                </div>
                <p><span class="grey-text">Sum of Odds:</span> <span id="oddsSum">0</span>%</p>
                <p><span class="grey-text">Price:</span> 
                    <span class="green-text">
                        <img style="max-height: 20px;" src="//rbx.place/img/funds.png" />
                        <span id="calculatedPrice">Free</span>
                    </span>
                </p>
            </div>
            <div class="row">
                <p>Preview</p>
                <div class="card item">
                    <div class="card-image">
                        <img src="https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/loading-gift.png" id="cratePreviewIcon">
                        <span class="crate-preview"><img src="https://t5.rbxcdn.com/b205dff257d73e647858c63c913b4b51" id="cratePreviewPreview"></span>
                    </div>
                    <div class="card-content">
                        <span class="card-title" id="cratePreviewName">Example Crate</span>
                        <div class="col s6">
                            <span class="grey-text">
                                Price
                            </span>
                        </div>
                        <div class="col s6">
                            <span class="green-text align-price">
                                <img style="max-height: 20px;" src="//rbx.place/img/funds.png" />
                                <span id="cratePreviewPrice">Free</span>
                            </span>
                        </div>
                    </div>
                    <div class="card-action">
                        <span class="btn waves-effect waves-light green" disabled="disabled">OPEN CRATE</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a> <a class="btn waves-effect waves-light green" onclick="createCrate();">Create Crate</a>
        </div>
    </div>

    <div id="inventory" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s4 left">
                    <span class="waves-effect waves-green btn" disabled="disabled">Withdraw All</span>
                </div>
                <div class="col s4 center">
                    <h4>Inventory</h4>
                </div>
                <div class="col s4 right">
                    <span class="waves-effect waves-green btn right green" onclick="convertAllToRobux();">
                        Convert All To
                        <img style="max-height: 25px; transform: translateY(6px);" src="https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/funds.png" />
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="user-items" id="inventoryDiv">

                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
        </div>
    </div>

    <div id="open-crate" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s4 left">
                    <span onclick="testSpin();" class="waves-effect waves-green btn">Free Test Spin</span>
                </div>
                <div class="col s4 center">
                    <h4 id="crateTitle"></h4>
                </div>
                <div class="col s4 right">
                    <span class="green-text align-price right">
                        <img style="max-height: 20px;" src="//rbx.place/img/funds.png" />
                        <p id="cratePrice"></p>
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="spin-open">
                    <div class="divider"></div>
                    <div class="spin-overlay"></div>
                    <div class="spin-items" id="spinFrame">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col s6 left">
                    <h4>Items in the crate:</h4>
                    <p>
                        <input type="checkbox" class="filled-in" id="winningNumbersCheckbox" />
                        <label for="winningNumbersCheckbox">Show winning numbers</label>
                    </p>
                </div>
                <div class="col s6 right">
                    <span class="waves-effect waves-green btn right green">Open This Case</span>
                </div>
            </div>
            <div class="row">
                <div class="case-items" id="caseInventory">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
        </div>
    </div>

    <div class="section no-pad-bot" id="index-banner">
        <div class="container">
            <br><br>
            <h1 class="header center orange-text">Welcome to <a href="http://rblx.fun">RBLX.Fun</a></h1>
            <div class="row center">
                <h5 class="header col s12 light"><a href="http://rblx.fun">RBLX.Fun</a> is a crate opening site where you can play and win items. Sign up to begin opening crates and win the items of your dreams</h5>
            </div>
            <div class="row center">
                <a href="#signin" id="discord-button" class="btn-large waves-effect waves-light orange modal-trigger" onclick="$('[href=\'#sign-in\']').click()">SIGN IN</a>
                <a target="_blank" href="https://discord.gg/UjVkpkF" id="discord-button" class="btn-large waves-effect waves-light purple"><i class="left material-icons">chat</i>DISCORD</a>
                <a href="#signin" id="discord-button" class="btn-large waves-effect waves-light orange modal-trigger" onclick="$('[href=\'#sign-up\']').click()">SIGN UP</a>
            </div>
            <br><br>
            <div class="row center" id="crates">
            </div>
        </div>
    </div>

    <footer class="page-footer orange">
        <div class="container">
            <div class="row">
                <div class="col l6 s12">
                    <h5 class="white-text">About</h5>
                    <p class="grey-text text-lighten-4">We are a crate opening site where you can play and win items. Sign up to begin opening crates and win the items of your dreams</p>
                </div>
                <div class="col l6 s12">
                    <h5 class="white-text">Links</h5>
                    <ul>
                        <li><a class="white-text" href="#!">Link 1</a></li>
                        <li><a class="white-text" href="#!">Link 2</a></li>
                        <li><a class="white-text" href="#!">Link 3</a></li>
                        <li><a class="white-text" href="#!">Link 4</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container">
                Made by doctor
            </div>
        </div>
    </footer>
</body>
</html>
