<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>RBLX.Fun</title>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.0/css/materialize.min.css">

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.0/js/materialize.min.js"></script>

    <style>
        .modal {
            max-height: 90%;
        }

        .modal-form-row {
            margin-bottom: 0px;
        }

        .align-price {
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
        }

        .item {
            width: 300px;
            display: inline-block;
            margin: 10px 10px 10px 10px;
        }

        .crate-item {
            width: 134px;
            display: inline-block;
            border-radius: 3px;
            margin: 5px 5px 5px 5px;
        }

        .crate-preview {
            position: absolute;
            bottom: -50px;
            right: -30px;
            width: 75%;
        }

        .spin-open {
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.14);
            width: 100%;
            white-space: nowrap;
            position: relative;
            overflow-x: hidden;
        }

        .spin-items {
            width: 100%;
            height: 100%;
        }

        .divider {
            content: "";
            position: absolute;
            height: 100%;
            left: 50%;
            margin-left: -3px;
            background: rgba(0,255,144,.6);
            width: 6px;
            z-index: 10;
            box-shadow: -1px 1px 8px 1px rgba(50,50,50,.75);
        }

        .case-items {
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.14);
            width: 100%;
            position: relative;
        }

        .winning-numbers {
            content: " ";
        }
    </style>

    <script>
        var tagBody = '(?:[^"\'>]|"[^"]*"|\'[^\']*\')*';

        var tagOrComment = new RegExp(
            '<(?:'
            // Comment body.
            + '!--(?:(?:-*[^->])*--+|-?)'
            // Special "raw text" elements whose content should be elided.
            + '|script\\b' + tagBody + '>[\\s\\S]*?</script\\s*'
            + '|style\\b' + tagBody + '>[\\s\\S]*?</style\\s*'
            // Regular name
            + '|/?[a-z]'
            + tagBody
            + ')>',
            'gi');
        function removeTags(html) {
            var oldHtml;
            do {
                oldHtml = html;
                html = html.replace(tagOrComment, '');
            } while (html !== oldHtml);
            return html.replace(/</g, '&lt;').replace(/"/g, '').replace(/'/g, '').replace(/\\/g, '');
        }
        function htmlToElement(html) {
            var template = document.createElement('template');
            template.innerHTML = html;
            return template.content.firstChild;
        }
    </script>

    <script>
        var cardTemplate = "PGRpdiBjbGFzcz0iY2FyZCBpdGVtIj4KCTxkaXYgY2xhc3M9ImNhcmQtaW1hZ2UiPgoJCTxpbWcgc3JjPSJ7MH0iPgoJCTxzcGFuIGNsYXNzPSJjcmF0ZS1wcmV2aWV3Ij48aW1nIHNyYz0iezN9Ij48L3NwYW4+Cgk8L2Rpdj4KCTxkaXYgY2xhc3M9ImNhcmQtY29udGVudCI+CgkJPHNwYW4gY2xhc3M9ImNhcmQtdGl0bGUiPnsxfTwvc3Bhbj4KCQk8ZGl2IGNsYXNzPSJjb2wgczYiPgoJCQk8c3BhbiBjbGFzcz0iZ3JleS10ZXh0Ij4KCQkJCVByaWNlCgkJCTwvc3Bhbj4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJjb2wgczYiPgoJCQk8c3BhbiBjbGFzcz0iZ3JlZW4tdGV4dCBhbGlnbi1wcmljZSI+CgkJCQk8aW1nIHN0eWxlPSJtYXgtaGVpZ2h0OiAyMHB4OyIgc3JjPSIvL3JieC5wbGFjZS9pbWcvZnVuZHMucG5nIiAvPgoJCQkJezJ9CgkJCTwvc3Bhbj4KCQk8L2Rpdj4KCTwvZGl2PgoJPGRpdiBjbGFzcz0iY2FyZC1hY3Rpb24iPgoJCTxzcGFuIGNsYXNzPSJidG4gd2F2ZXMtZWZmZWN0IHdhdmVzLWxpZ2h0IGdyZWVuIiBvbmNsaWNrPSJkaXNwbGF5Q3JhdGVPcGVuZXIodGhpcyk7Ij5PUEVOIENSQVRFPC9zcGFuPgoJPC9kaXY+CjwvZGl2Pg==";
        var itemTemplate = "PGRpdiBjbGFzcz0iY2FyZCBjcmF0ZS1pdGVtIj4KCTxkaXYgY2xhc3M9ImNhcmQtaW1hZ2UiIHN0eWxlPSJib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjEpIj4KCQk8aW1nIHNyYz0iezB9Ij4KCTwvZGl2PgoJPGRpdiBjbGFzcz0iY2FyZC1jb250ZW50IiBzdHlsZT0icGFkZGluZzogNHB4IDRweCA0cHggNHB4Ij4KCQk8cD57MX08L3A+CgkJPHAgY2xhc3M9ImdyZXktdGV4dCI+ezN9PC9wPgoJCTxkaXYgY2xhc3M9ImNvbCBzMTIiPgoJCQk8c3BhbiBjbGFzcz0iZ3JlZW4tdGV4dCBhbGlnbi1wcmljZSI+CgkJCQk8aW1nIHN0eWxlPSJtYXgtaGVpZ2h0OiAyMHB4OyIgc3JjPSIvL3JieC5wbGFjZS9pbWcvZnVuZHMucG5nIiAvPgoJCQkJezJ9CgkJCTwvc3Bhbj4KCQk8L2Rpdj4KCTwvZGl2Pgo8L2Rpdj4=";
        
        if (!String.prototype.format) {
            String.prototype.format = function () {
                var args = arguments;
                return this.replace(/{(\d+)}/g, function (match, number) {
                    return typeof args[number] != 'undefined'
                        ? args[number]
                        : match
                        ;
                });
            };
        }

        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        function getValue(price) {
            return price <= 0 ? "Free" : price.toLocaleString();
        }

        function displayCard(img, title, price, preview) {
            var crates = document.getElementById('crates');
            var card = htmlToElement(atob(cardTemplate).format(removeTags(img), removeTags(title), getValue(price), removeTags(preview)));

            card.crateTitle = title;
            card.cratePrice = price;

            crates.appendChild(card);
        }

        function testSpin() {
            var targetItem = "";
            var spinFrame = document.getElementById('spinFrame');
            var crate = spinFrame.children;

            var winningNumber = parseInt(Math.random() * spinFrame.winningNumbers);
            console.log("New Test Spin!\nWinning Number: " + winningNumber + "\nPrize: " + targetItem);

            var winningNumbers = 0;
            var items = spinFrame.items;
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var numbersRange = winningNumbers + item.tickets;

                if (winningNumber >= winningNumbers && winningNumber < numbersRange) {
                    targetItem = item.name;
                }

                winningNumbers = numbersRange;
            }

            var audio = new Audio('https://raw.githubusercontent.com/Cryption/rblx.fun/master/tick.wav');

            var targetIndex = parseInt(Math.random() * (crate.length - 20)) + 10;
            for (var i = targetIndex; i < crate.length; i++) {
                if (crate[i].item.name == targetItem) {
                    targetIndex = i;
                    break;
                }
            }

            var targetX = (spinFrame.clientWidth / 2) - (crate[targetIndex].offsetLeft + (Math.random() * crate[targetIndex].clientWidth));
            var x = 0;
            var maxSpeed = 25;
            if (typeof (currentSpin) != 'undefined')
                clearInterval(currentSpin);
            currentSpin = setInterval(function () {
                if (parseInt((x + (crate[targetIndex].clientWidth / 2)) / crate[targetIndex].clientWidth) < parseInt((x + Math.min(maxSpeed, (-targetX - x) * .006) + (crate[targetIndex].clientWidth / 2)) / crate[targetIndex].clientWidth)) {
                    audio.play();
                }

                x += Math.min(maxSpeed, (-targetX - x) * .006);

                spinFrame.style.webkitTransform = "translateX(" + -x + "px)";
                spinFrame.style.transform = "translateX(" + -x + "px)";
                spinFrame.style.msTransform = "translateX(" + -x + "px)";
            }, 15);
        }

        function displayCrateOpener(btn) {
            var items = [{
                    img: "https://t2.rbxcdn.com/82cb24afec92ee77269760a7c0e522a2",
                    name: "Domino Crown",
                    price: 7000000,
                    tickets: 1
                }, {
                    img: "https://t4.rbxcdn.com/d8df9a201fe4530dc87a103019bbaee5",
                    name: "Rainbow Shaggy",
                    price: 2399999,
                    tickets: 1
                }, {
                    img: "https://t2.rbxcdn.com/c9b13158b51ab0b40bc8d9d5adb3e9a4",
                    name: "Dominus Fridgus",
                    price: 10000000,
                    tickets: 1
                }, {
                    img: "https://t5.rbxcdn.com/d732f08c22bd856893d57487c8fa10df",
                    name: "Bling $$ Necklace",
                    price: 1428572,
                    tickets: 1
                }, {
                    img: "https://t6.rbxcdn.com/47b568333007056a1707dafdd68c4a4c",
                    name: "Blond Spiked Hair",
                    price: 0,
                    tickets: 1000
                }];

            document.getElementById('crateTitle').innerHTML = removeTags(btn.parentElement.parentElement.crateTitle);
            document.getElementById('cratePrice').innerHTML = getValue(btn.parentElement.parentElement.cratePrice);
            document.getElementById('winningNumbersCheckbox').checked = false;
            document.getElementById('spinFrame').innerHTML = "";
            document.getElementById('caseInventory').innerHTML = "";
            for (var j = 0; j < 25; j++) {
                var shuffledItems = shuffle(items);
                for (var i = 0; i < items.length; i++) {
                    var item = shuffledItems[i];
                    var itemCard = htmlToElement(atob(itemTemplate).format(removeTags(item.img), removeTags(item.name), getValue(item.price), ''));
                    itemCard.item = item;
                    document.getElementById('spinFrame').appendChild(itemCard);
                }
            }

            var winningNumbers = 0;
            for (var i = 0; i < items.length; i++) {
                var item = items[i];
                var itemCard = htmlToElement(atob(itemTemplate).format(removeTags(item.img), removeTags(item.name), getValue(item.price), '<span class="winning-numbers">' + winningNumbers + ' - ' + (winningNumbers + item.tickets) + '</span>'));
                winningNumbers += item.tickets;
                document.getElementById('caseInventory').appendChild(itemCard);
            }
            document.getElementById('spinFrame').winningNumbers = winningNumbers;
            document.getElementById('spinFrame').items = items;

            $(".winning-numbers").hide();
            $('#open-crate').modal('open');
        }

        $(document).ready(function () {
            // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
            $('.modal').modal();
            $('ul.tabs').tabs();

            var giftImages = ['https://t4.rbxcdn.com/e77ebd99144a1d6c44519b85e003b75a', 'https://t4.rbxcdn.com/a392643ab4cf3b55393200f85b6d0a23',
                'https://t1.rbxcdn.com/de7f2fe32e223a74c70e7d1072d7114c', 'https://t0.rbxcdn.com/55d1aed888beb2d2d0d3a77549b902d4'];
            var giftTitles = ['ez dominus', 'kazok is the best', '50/50 case', 'BEST CASE EVER', 'gooms original', '99% profit case!', 'EZ profit', 'goombas waffle stomp'];
            var giftPreviews = ['https://t0.rbxcdn.com/506c5b943e8b5ca77d19a957aae1278a', 'https://t2.rbxcdn.com/c9b13158b51ab0b40bc8d9d5adb3e9a4', 'https://t2.rbxcdn.com/82cb24afec92ee77269760a7c0e522a2',
                'https://t7.rbxcdn.com/3bd95ae760f426f1502f2de4880acf5b', 'https://t4.rbxcdn.com/d8df9a201fe4530dc87a103019bbaee5', 'https://t6.rbxcdn.com/76b1655e1e082d8b2bd681218eba89af'];

            for (var i = 0; i < 4 * 3; i++) {
                displayCard(
                    giftImages[parseInt(Math.random() * giftImages.length)],
                    giftTitles[parseInt(Math.random() * giftTitles.length)],
                    1000,
                    giftPreviews[parseInt(Math.random() * giftPreviews.length)]);
            }

            $('#winningNumbersCheckbox').on('change', function () {
                var c = this.checked;
                if (c)
                    $(".winning-numbers").show(100);
                else
                    $(".winning-numbers").hide(100);
            });
        });

        $("#signup_pass").on("focusout", function (e) {
            if ($(this).val() != $("#signup_confirmpass").val()) {
                $("#signup_confirmpass").removeClass("valid").addClass("invalid");
            } else {
                $("#signup_confirmpass").removeClass("invalid").addClass("valid");
            }
        });

        $("#signup_confirmpass").on("keyup", function (e) {
            if ($("#signup_pass").val() != $(this).val()) {
                $(this).removeClass("valid").addClass("invalid");
            } else {
                $(this).removeClass("invalid").addClass("valid");
            }
        });
    </script>
</head>
<body>
    <nav class="light-blue lighten-1" role="navigation">
        <div class="nav-wrapper container">
            <a id="logo-container" href="#" class="brand-logo"><img src="https://raw.githubusercontent.com/Cryption/rblx.fun/master/images/logo.png" style="padding-top: 4px; height: 60px;" /></a>
            <ul class="right hide-on-med-and-down">
                <li><a href="#">Crates</a></li>
                <li><a href="#">Deposit</a></li>
                <li><a href="#">Inventory</a></li>
                <a href="#signin" class="btn waves-effect waves-light orange modal-trigger">Sign In</a>
            </ul>

            <ul id="nav-mobile" class="side-nav" style="transform: translateX(-100%);">
                <li><a href="#">Cases</a></li>
                <li><a href="#">Deposit</a></li>
                <li><a href="#">Inventory</a></li>
                <a href="#signin" class="btn waves-effect waves-light orange modal-trigger">Sign In</a>
            </ul>
            <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
        </div>
    </nav>

    <div id="signin" class="modal" style="width:20%">
        <div class="modal-header">
            <div class="row">
                <div class="col s12">
                    <ul class="tabs">
                        <li class="tab col s6"><a class="active" href="#sign-in">Sign In</a></li>
                        <li class="tab col s6"><a href="#sign-up">Sign Up</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div id="sign-in">
            <div class="modal-content">
                <h4>Sign In</h4>

                <div class="row">
                    <form class="col s12">
                        <div class="row modal-form-row">
                            <div class="input-field col s12">
                                <input id="signin_user" type="text" class="validate">
                                <label for="signin_user">Username</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="signin_pass" type="password" class="validate">
                                <label for="signin_pass">Password</label>
                            </div>
                        </div>
                        <div class="row">
                            <p>
                                <input type="checkbox" class="filled-in" id="rememberMe" />
                                <label for="rememberMe">Remember me</label>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <a class="modal-action modal-close btn waves-effect waves-light orange">Sign In</a>
            </div>
        </div>
        <div id="sign-up">
            <div class="modal-content">
                <h4>Sign Up</h4>

                <div class="row">
                    <form class="col s12">
                        <div class="row modal-form-row">
                            <div class="input-field col s12">
                                <input id="signup_user" type="text" class="validate">
                                <label for="signup_user">Username</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="signup_pass" type="password" class="validate">
                                <label for="signup_pass">Password</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-field col s12">
                                <input id="signup_confirmpass" type="password">
                                <label for="signup_confirmpass" data-error="Password not match" data-success="Password Match">Password (Confirm)</label>
                            </div>
                        </div>
                        <div class="row">
                            <p>
                                <input type="checkbox" class="filled-in" id="over18" />
                                <label for="over18">I am over 18</label>
                            </p>
                        </div>
                        <div class="row">
                            <p class="input-field">
                                <input type="checkbox" class="filled-in" id="tos" />
                                <label for="tos">I agree to the <a href="http://kazok.men/">terms and conditions</a></label>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <a class="modal-action modal-close btn waves-effect waves-light orange">Sign Up</a>
            </div>
        </div>
    </div>

    <div id="open-crate" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s4 left">
                    <span onclick="testSpin();" class="waves-effect waves-green btn">Free Test Spin</span>
                </div>
                <div class="col s4 center">
                    <h4 id="crateTitle"></h4>
                </div>
                <div class="col s4 right">
                    <span class="green-text align-price right">
                        <img style="max-height: 20px;" src="//rbx.place/img/funds.png" />
                        <p id="cratePrice"></p>
                    </span>
                </div>
            </div>
            <div class="row">
                <div class="spin-open">
                    <div class="divider"></div>
                    <div class="spin-items" id="spinFrame">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col s6 left">
                    <h4>Items in the case:</h4>
                    <p>
                        <input type="checkbox" class="filled-in" id="winningNumbersCheckbox" />
                        <label for="winningNumbersCheckbox">Show winning numbers</label>
                    </p>
                </div>
                <div class="col s6 right">
                    <span class="waves-effect waves-green btn right green">Open This Case</span>
                </div>
            </div>
            <div class="row">
                <div class="case-items" id="caseInventory">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Cancel</a>
        </div>
    </div>

    <div class="section no-pad-bot" id="index-banner">
        <div class="container">
            <br><br>
            <h1 class="header center orange-text">Welcome to <a href="http://rblx.fun">RBLX.Fun</a></h1>
            <div class="row center">
                <h5 class="header col s12 light"><a href="http://rblx.fun">RBLX.Fun</a> is a crate opening site where you can play and win items. Sign up to begin opening crates and win the items of your dreams</h5>
            </div>
            <div class="row center">
                <a href="#signin" id="discord-button" class="btn-large waves-effect waves-light orange modal-trigger" onclick="$('[href=\'#sign-in\']').click()">SIGN IN</a>
                <a target="_blank" href="https://discord.gg/UjVkpkF" id="discord-button" class="btn-large waves-effect waves-light purple"><i class="left material-icons">chat</i>DISCORD</a>
                <a href="#signin" id="discord-button" class="btn-large waves-effect waves-light orange modal-trigger" onclick="$('[href=\'#sign-up\']').click()">SIGN UP</a>
            </div>
            <br><br>
            <div class="row center" id="crates">
            </div>
        </div>
    </div>

    <footer class="page-footer orange">
        <div class="container">
            <div class="row">
                <div class="col l6 s12">
                    <h5 class="white-text">About</h5>
                    <p class="grey-text text-lighten-4">We are a crate opening site where you can play and win items. Sign up to begin opening crates and win the items of your dreams</p>
                </div>
                <div class="col l6 s12">
                    <h5 class="white-text">Links</h5>
                    <ul>
                        <li><a class="white-text" href="#!">Link 1</a></li>
                        <li><a class="white-text" href="#!">Link 2</a></li>
                        <li><a class="white-text" href="#!">Link 3</a></li>
                        <li><a class="white-text" href="#!">Link 4</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container">
                Made by doctor
            </div>
        </div>
    </footer>
</body>
</html>
